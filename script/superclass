#!/bin/sh

class=$1
define=$(echo "${class}" | tr '[:lower:]' '[:upper:]')

echo "#ifndef ${define}_H"
echo "#define ${define}_H"
echo ""
echo "/* Automatically generated by script/superclass */"
echo "#define __inherits_from_${class}__ struct ${class} __parent_${class}__"
echo "#define __${class}_is_superclass__ void *__self_${class}__"
echo "#define __${class}__(x) (&((x)->__parent_${class}__))"
echo "#define __${class}_self__(x) ((struct ${class}*)x)->__self_${class}__"
echo "#define __${class}_self_init__(x, self) (x)->__self_${class}__ = self"
echo "/* TODO : modify super() if needed */"
echo "#define __${class}_super__(self, ...) \\"
echo "  __${class}_self_init__(__${class}__(self), self); \\"
echo "  ${class}_init(__${class}__(self), ...);"
echo "#define __${class}_free__(self) ${class}_free(__${class}__(self));"
echo ""
echo "struct ${class} {" 
echo "  __${class}_is_superclass__;"
echo "  /* TODO : complete this */"
echo "};"
echo ""
echo "int ${class}_init(struct ${class} *${class}, void *self, ...);"
echo "void ${class}_free(struct ${class} *${class});"
echo ""
echo "#endif"
